<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>OfficeVisitBaseAction.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">iTrust</a> &gt; <a href="index.source.html" class="el_package">edu.ncsu.csc.itrust.action.base</a> &gt; <span class="el_source">OfficeVisitBaseAction.java</span></div><h1>OfficeVisitBaseAction.java</h1><pre class="source lang-java linenums">package edu.ncsu.csc.itrust.action.base;

import edu.ncsu.csc.itrust.dao.DAOFactory;
import edu.ncsu.csc.itrust.dao.mysql.OfficeVisitDAO;
import edu.ncsu.csc.itrust.exception.ITrustException;

/**
 * An abstract class which contains functionalities common among all actions relating to inserting and editing
 * office visits. Because all office visits are with a certain patient, OfficeVisitBaseAction extends
 * PatientBaseAction.
 * 
 * Use this class whenever you have a page which not only requires a patient MID, but an office visit ID. Pass
 * those IDs to the constructor, and an exception will be thrown if they are not valid IDs (which should kick
 * the user out to the home page).
 * 
 * The concrete methods created by this class allow for its association with the unique identifier of a given
 * office visit. These identifiers can also be verified for their correctness and existence.
 * 
 * Very similar to {@link PatientBaseAction} and {@link PersonnelBaseAction}
 */
abstract public class OfficeVisitBaseAction extends PatientBaseAction {
	private static final long UNSAVED_VISIT_ID = -1;

	/**
	 * A database access object for dealing with office visits.
	 */
	private OfficeVisitDAO ovDAO;

	/**
	 * The unique identifier of the office visit this action is associated with.
	 */
	protected long ovID;

	/**
	 * The default constructor.
	 * 
	 * @param factory
	 *            A database access object factory for supplying a runtime context.
	 * @param pidString
	 *            The patient's MID as a String, to be passed to the super constructor (for PatientBaseAction)
	 * @param ovIDString
	 *            The unique identifier of the office visit as a String.
	 * @throws ITrustException
	 *             If any of the supplied parameters is incorrect or there is a DB problem.
	 */
	public OfficeVisitBaseAction(DAOFactory factory, String pidString, String ovIDString)
			throws ITrustException {
<span class="fc" id="L48">		super(factory, pidString);</span>
<span class="fc" id="L49">		this.ovDAO = factory.getOfficeVisitDAO();</span>
<span class="fc" id="L50">		this.ovID = checkOfficeVisitID(ovIDString);</span>
<span class="fc" id="L51">	}</span>
	
	
	/**
	 * Constructs an action that is initially unsaved.  Like the three-argument 
	 * constructor except that the office visit id is a sentinel value and does 
	 * not represent a valid office visit.
	 * 
	 * @param factory
	 * @param pidString
	 * @throws ITrustException
	 */
	public OfficeVisitBaseAction(DAOFactory factory, String pidString)
			throws ITrustException {
<span class="fc" id="L65">		super(factory, pidString);</span>
<span class="fc" id="L66">		this.ovDAO = factory.getOfficeVisitDAO();</span>
<span class="fc" id="L67">		this.ovID = UNSAVED_VISIT_ID;</span>
<span class="fc" id="L68">	}</span>

	/**
	 * Asserts whether this unique office visit identifier both exists and is associated with the patient in
	 * the database.
	 * 
	 * @param input
	 *            The presumed identifier as a String.
	 * @return The same identifier as a long of the existing office visit.
	 * @throws ITrustException
	 *             If the visit does not exist or if there is a DB problem.
	 */
	private long checkOfficeVisitID(String input) throws ITrustException {
		try {
<span class="fc" id="L82">			encode(input);</span>
<span class="fc" id="L83">			long ovID = Long.valueOf(input);</span>

<span class="fc bfc" id="L85" title="All 2 branches covered.">			if (ovDAO.checkOfficeVisitExists(ovID, pid))</span>
<span class="fc" id="L86">				return ovID;</span>
			else
<span class="fc" id="L88">				throw new ITrustException(&quot;Office Visit &quot; + ovID + &quot; with Patient MID &quot; + pid</span>
						+ &quot; does not exist&quot;);
<span class="fc" id="L90">		} catch (NumberFormatException e) {</span>
<span class="fc" id="L91">			throw new ITrustException(&quot;Office Visit ID is not a number: &quot; + e.getMessage());</span>
		}
	}
	
	/**
	 * Indicates if the office visit has been saved or not.
	 * @return boolean that indicates if this has been saved. 
	 */
	public boolean isUnsaved() {
<span class="fc bfc" id="L100" title="All 2 branches covered.">		return ovID == UNSAVED_VISIT_ID;</span>
	}
	
	/**
	 * Raises an exception if the office visit has not been saved.  Otherwise, 
	 * does nothing. 
	 * @throws ITrustException
	 */
	protected void verifySaved() throws ITrustException {
<span class="fc bfc" id="L109" title="All 2 branches covered.">		if (isUnsaved()) {</span>
<span class="fc" id="L110">			throw new ITrustException(&quot;Cannot perform action.  OfficeVisit is not saved.&quot;);</span>
		}
<span class="fc" id="L112">	}</span>

	/**
	 * For obtaining the unique identifier of the office visit this action is associated with.
	 * 
	 * @return A long of the identifier.
	 */
	public long getOvID() {
<span class="fc" id="L120">		return ovID;</span>
	}

	/**
	 * Converts all characters of the input string to their HTML special characters equivalent representation.
	 * Explicitly, the less than symbol becomes lt, the greater than symbol becomes gt and a newline feed
	 * becomes br.
	 * 
	 * @param input
	 *            The string to encode.
	 * @return The encoded string.
	 */
	public String encode(String input) {
<span class="fc" id="L133">		String str = input.replaceAll(&quot;&lt;&quot;, &quot;&amp;lt;&quot;);</span>
<span class="fc" id="L134">		str = str.replaceAll(&quot;&gt;&quot;, &quot;&amp;gt;&quot;);</span>
<span class="fc" id="L135">		str = str.replaceAll(&quot;\n&quot;, &quot;&lt;br /&gt;&quot;);</span>
<span class="fc" id="L136">		return str;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>