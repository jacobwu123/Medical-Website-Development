<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DesignateNutritionistAction.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">iTrust</a> &gt; <a href="index.source.html" class="el_package">edu.ncsu.csc.itrust.action</a> &gt; <span class="el_source">DesignateNutritionistAction.java</span></div><h1>DesignateNutritionistAction.java</h1><pre class="source lang-java linenums">package edu.ncsu.csc.itrust.action;

import java.util.List;

import edu.ncsu.csc.itrust.beans.PersonnelBean;
import edu.ncsu.csc.itrust.dao.DAOFactory;
import edu.ncsu.csc.itrust.dao.mysql.PatientDAO;
import edu.ncsu.csc.itrust.dao.mysql.PersonnelDAO;
import edu.ncsu.csc.itrust.exception.DBException;
import edu.ncsu.csc.itrust.exception.ITrustException;

/**
 * Responsible for allowing only designated nutritionists
 * to view the Nutritional information of patients. Patients
 * can declare their designated nutritionist
 */
public class DesignateNutritionistAction {
	
	private PersonnelDAO personnelDAO;
	private PatientDAO patientDAO;
	private long loggedInMID;
	
<span class="fc" id="L23">	public DesignateNutritionistAction(DAOFactory factory, long loggedInMID) {</span>
<span class="fc" id="L24">		personnelDAO = factory.getPersonnelDAO();</span>
<span class="fc" id="L25">		patientDAO = factory.getPatientDAO();</span>
<span class="fc" id="L26">		this.loggedInMID = loggedInMID;</span>
<span class="fc" id="L27">	}</span>
	
	/**
	 * Returns a list of all of the HCPs who have a specialty
	 * of Nutritionist
	 */
	public List&lt;PersonnelBean&gt; getAllNutritionists() throws ITrustException {
		try {
<span class="fc" id="L35">			return personnelDAO.getAllNutritionists();</span>
<span class="fc" id="L36">		} catch (DBException d) {</span>
<span class="fc" id="L37">			throw new ITrustException(&quot;Error retrieving HCPs&quot;);</span>
		}
	}

	/**
	 * Allows the patient to update who his designated nutritionist is.
	 * A patient may choose to have no designated nutritionist in which
	 * case no hcp may view his nutritional information.
	 * return 0 means nothing happened
	 * return -1 means the nutritionist is already his designated nutritionist
	 * return -2 means hcp is not a nutritionist
	 * return positive number means successful update
	 */
	public int updateNutritionist(long HCPID) throws ITrustException {
		/* If the HCPID = -1 (HCPID can never be -1), then the
		 * patient wishes to have 'None' as his selected hcp and 
		 * we will delete it.
		 * if not -1, we will try first to just update it, and assume that 
		 * the patient already has a designated nutritionist, if not
		 * we will add 1 for him
		 */
		try {
<span class="fc" id="L59">			int updated = 0;</span>
<span class="fc" id="L60">			PersonnelBean personnel = personnelDAO.getPersonnel(HCPID);</span>
<span class="fc" id="L61">			PersonnelBean currentHCP = getDesignatedNutritionist();</span>
<span class="fc bfc" id="L62" title="All 4 branches covered.">			if (personnel != null &amp;&amp; currentHCP != null &amp;&amp; </span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">					(personnel.getMID() == currentHCP.getMID())) {</span>
				//the patient wants to update it to his current nutritionist
<span class="fc" id="L65">				updated = -1;</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">			} else if (HCPID == -1) {</span>
<span class="fc" id="L67">				updated = patientDAO.deleteDesignatedNutritionist(loggedInMID);</span>
				
			} else { //must want to change/add his designated nutritionist
				//must first make sure the hcp in question has 
				//specialty of nutritionist
<span class="fc bfc" id="L72" title="All 2 branches covered.">				boolean isNutritionist = (personnel != null &amp;&amp;</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">						personnel.getSpecialty().equalsIgnoreCase(&quot;Nutritionist&quot;));</span>
<span class="fc bfc" id="L74" title="All 2 branches covered.">				if (isNutritionist) {</span>
<span class="fc" id="L75">					updated = patientDAO.</span>
<span class="fc" id="L76">							updateDesignatedNutritionist(loggedInMID, HCPID);</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">					if (updated == 0) { //didn't update anything, so have to add</span>
<span class="fc" id="L78">						updated = patientDAO.addDesignatedNutritionist(loggedInMID, HCPID);</span>
					}
				} else {
<span class="fc" id="L81">					updated = -2;</span>
				}
			}
<span class="fc" id="L84">			return updated;</span>
<span class="fc" id="L85">		} catch (DBException d) {</span>
<span class="fc" id="L86">			throw new ITrustException(&quot;Error retrieving information&quot;);</span>
		}
	}
	
	public PersonnelBean getDesignatedNutritionist() throws ITrustException {
		try {
<span class="fc" id="L92">			long HCPID = patientDAO.getDesignatedNutritionist(loggedInMID);</span>
<span class="fc" id="L93">			PersonnelBean HCP = personnelDAO.getPersonnel(HCPID);</span>
<span class="fc" id="L94">			return HCP;</span>
<span class="fc" id="L95">		} catch (DBException d) {</span>
<span class="fc" id="L96">			throw new ITrustException(&quot;Error retrieving information&quot;);</span>
		}
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>